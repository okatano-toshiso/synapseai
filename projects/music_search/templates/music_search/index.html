{% extends "custom.html" %}
{% block title %}Music Search{% endblock %}
{% block content %}
{% load static %}

<section class="contents">
    <h2 class="title">Music Search</h2>
    <p class="description">
        アーティスト名を入力すると、Wikipedia、公式サイト、Spotify、YouTubeからアルバム情報を検索します。
    </p>
    
    <form method="POST">
        {% csrf_token %}
        <article class="search-area">
            <h3 class="label">検索フォーム</h3>
            <div class="form-group">
                <label>{{ form.language.label }}</label>
                <div class="radio-group">
                    {{ form.language }}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group half">
                    <label for="{{ form.artist_name.id_for_label }}">{{ form.artist_name.label }}</label>
                    {{ form.artist_name }}
                </div>
                <div class="form-group half">
                    <label for="{{ form.album_name.id_for_label }}">{{ form.album_name.label }}</label>
                    {{ form.album_name }}
                </div>
            </div>
            <div class="submit_area">
                <button type="submit" class="output">検索</button>
                <button type="reset" class="reset">リセット</button>
            </div>
        </article>
    </form>
    
    {% if search_results.artist_name %}
    <article class="result">
        <h3 class="label">検索結果: {{ search_results.artist_name }} ({{ search_results.language }})</h3>
        
        <div class="result_area">
            <div class="artist-info">
                <h4>アーティスト情報</h4>
                {% if search_results.artist_wiki_url %}
                <p class="info-item">
                    <strong>Wikipedia:</strong> 
                    <a href="{{ search_results.artist_wiki_url }}" target="_blank">{{ search_results.artist_wiki_url }}</a>
                </p>
                {% endif %}
                
                {% if search_results.official_biography_url %}
                <p class="info-item">
                    <strong>公式バイオグラフィ:</strong> 
                    <a href="{{ search_results.official_biography_url }}" target="_blank">{{ search_results.official_biography_url }}</a>
                </p>
                {% endif %}
                
                {% if search_results.official_discography_url %}
                <p class="info-item">
                    <strong>公式ディスコグラフィ:</strong> 
                    <a href="{{ search_results.official_discography_url }}" target="_blank">{{ search_results.official_discography_url }}</a>
                </p>
                {% endif %}
            {% if search_results.album_name %}
            <p class="info-item">
                <strong>指定アルバム:</strong>
                {{ search_results.album_name }}
                {% if search_results.album_wiki_url %}
                — <a href="{{ search_results.album_wiki_url }}" target="_blank">{{ search_results.album_wiki_url }}</a>
                {% else %}
                — WikipediaのURLが見つかりませんでした。
                {% endif %}
            </p>
            {% endif %}
            </div>
            
            {% if search_results.albums %}
            <div class="albums-section">
                <h4>アルバム一覧 ({{ search_results.albums|length }}件)</h4>
                <div class="albums-grid">
                    {% for album in search_results.albums %}
                    <div class="album-card">
                        <div class="album-header">
                            <h5 class="album-title">{{ album.title }}</h5>
                            {% if album.year %}
                            <span class="album-year">{{ album.year }}</span>
                            {% endif %}
                        </div>
                        
                        {% if album.spotify_image %}
                        <div class="album-image">
                            <img src="{{ album.spotify_image }}" alt="{{ album.title }}" loading="lazy">
                            <a href="{{ album.spotify_image }}" download="{{ album.title }}.jpg" class="download-btn">
                                ダウンロード
                            </a>
                        </div>
                        {% endif %}
                        
                        <div class="album-links">
                            {% if album.wiki_url %}
                            <p class="link-item">
                                <strong>Wikipedia:</strong> 
                                <a href="{{ album.wiki_url }}" target="_blank">リンク</a>
                            </p>
                            {% endif %}
                            
                            {% if album.spotify_url %}
                            <p class="link-item">
                                <strong>Spotify:</strong> 
                                <a href="{{ album.spotify_url }}" target="_blank">リンク</a>
                            </p>
                            {% endif %}
                            
                            {% if album.youtube_url %}
                            <p class="link-item">
                                <strong>YouTube:</strong> 
                                <a href="{{ album.youtube_url }}" target="_blank">リンク</a>
                            </p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <p class="no-results">アルバム情報が見つかりませんでした。</p>
            {% endif %}
        </div>
        
        <div class="copy_area">
            <button id="copyButton" class="copy">URLをコピー</button>
        </div>
    </article>
    {% endif %}
</section>

<style>
.search-area {
    background: #f5f5f5;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 20px;
}
.form-row {
    display: flex;
    gap: 20px;
    align-items: flex-end;
}
.form-row .half {
    flex: 1;
}

.radio-group {
    display: flex;
    gap: 20px;
    margin-top: 10px;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 5px;
}

.artist-info {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.info-item {
    margin: 10px 0;
    line-height: 1.6;
}

.albums-section {
    margin-top: 30px;
}

.albums-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.album-card {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
}

.album-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.album-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #007bff;
}

.album-title {
    margin: 0;
    font-size: 1.1em;
    color: #333;
}

.album-year {
    background: #007bff;
    color: white;
    padding: 3px 10px;
    border-radius: 4px;
    font-size: 0.9em;
}

.album-image {
    position: relative;
    margin-bottom: 15px;
    text-align: center;
}

.album-image img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
}

.download-btn {
    display: inline-block;
    margin-top: 10px;
    padding: 8px 15px;
    background: #28a745;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 0.9em;
    transition: background 0.2s;
}

.download-btn:hover {
    background: #218838;
}

.album-links {
    margin-top: 10px;
}

.link-item {
    margin: 8px 0;
    font-size: 0.95em;
}

.link-item a {
    color: #007bff;
    text-decoration: none;
}

.link-item a:hover {
    text-decoration: underline;
}

.no-results {
    text-align: center;
    padding: 40px;
    color: #666;
    font-size: 1.1em;
}

.submit_area {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.output, .reset, .copy {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
    transition: background 0.2s;
}

.output {
    background: #007bff;
    color: white;
}

.output:hover {
    background: #0056b3;
}

.reset {
    background: #6c757d;
    color: white;
}

.reset:hover {
    background: #5a6268;
}

.copy {
    background: #17a2b8;
    color: white;
}

.copy:hover {
    background: #138496;
}
</style>

<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    const copyButton = document.getElementById('copyButton');
    
    if (copyButton) {
        copyButton.addEventListener('click', function() {
            const resultArea = document.querySelector('.result_area');
            const links = resultArea.querySelectorAll('a');
            let text = '';
            
            links.forEach(function(link) {
                text += link.href + '\n';
            });
            
            navigator.clipboard.writeText(text).then(function() {
                const originalText = copyButton.textContent;
                copyButton.textContent = 'コピーしました！';
                setTimeout(function() {
                    copyButton.textContent = originalText;
                }, 2000);
            });
        });
    }
});
</script>

{% endblock %}
