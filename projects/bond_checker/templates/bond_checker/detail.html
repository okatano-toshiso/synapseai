{% extends 'bond_checker/base.html' %}

{% block title %}{{ bond_doc.file_name }} - è©³ç´°{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{% url 'bond_checker:index' %}" class="btn btn-outline-secondary">
        â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
    </a>
</div>

<div class="upload-area">
    <h2 class="mb-4">ğŸ“„ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè©³ç´°</h2>
    
    <div class="row mb-4">
        <div class="col-md-6">
            <h5>ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±</h5>
            <table class="table table-borderless">
                <tr>
                    <th width="120">ãƒ•ã‚¡ã‚¤ãƒ«å:</th>
                    <td>{{ bond_doc.file_name }}</td>
                </tr>
                <tr>
                    <th>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—:</th>
                    <td>
                        {% if bond_doc.file_type == 'pdf' %}
                            ğŸ“„ PDF
                        {% else %}
                            ğŸ–¼ï¸ ç”»åƒ
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚:</th>
                    <td>{{ bond_doc.uploaded_at|date:"Yå¹´mæœˆdæ—¥ H:i:s" }}</td>
                </tr>
                <tr>
                    <th>è§£æçŠ¶æ³:</th>
                    <td>
                        {% if bond_doc.analysis_status == 'completed' %}
                            <span class="status-badge status-completed">âœ“ å®Œäº†</span>
                        {% elif bond_doc.analysis_status == 'processing' %}
                            <span class="status-badge status-processing">â³ å‡¦ç†ä¸­</span>
                        {% elif bond_doc.analysis_status == 'failed' %}
                            <span class="status-badge status-failed">âœ— å¤±æ•—</span>
                        {% else %}
                            <span class="status-badge status-pending">å¾…æ©Ÿä¸­</span>
                        {% endif %}
                    </td>
                </tr>
                {% if bond_doc.analyzed_at %}
                <tr>
                    <th>è§£æå®Œäº†æ—¥æ™‚:</th>
                    <td>{{ bond_doc.analyzed_at|date:"Yå¹´mæœˆdæ—¥ H:i:s" }}</td>
                </tr>
                {% endif %}
            </table>
        </div>
    </div>

    {% if bond_doc.analysis_status == 'completed' %}
    
    <!-- å‡¦ç†æ™‚é–“ã®æ¯”è¼ƒ -->
    <div class="mt-4">
        <h5>â±ï¸ å‡¦ç†æ™‚é–“ã®æ¯”è¼ƒ</h5>
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6>{% if bond_doc.file_type == 'pdf' %}pdfplumber{% else %}Tesseract OCR{% endif %}</h6>
                        {% if bond_doc.ocr_processing_time %}
                            <h3 class="text-primary">{{ bond_doc.ocr_processing_time|floatformat:2 }}ç§’</h3>
                            <span class="status-badge status-{{ bond_doc.ocr_status }}">{{ bond_doc.ocr_status }}</span>
                        {% else %}
                            <p class="text-muted">æœªå®Ÿè¡Œ</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6>GPT-4o</h6>
                        {% if bond_doc.ai_processing_time %}
                            <h3 class="text-info">{{ bond_doc.ai_processing_time|floatformat:2 }}ç§’</h3>
                            <span class="status-badge status-{{ bond_doc.ai_status }}">{{ bond_doc.ai_status }}</span>
                        {% else %}
                            <p class="text-muted">æœªå®Ÿè¡Œ</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6>Gemini</h6>
                        {% if bond_doc.gemini_processing_time %}
                            <h3 class="text-success">{{ bond_doc.gemini_processing_time|floatformat:2 }}ç§’</h3>
                            <span class="status-badge status-{{ bond_doc.gemini_status }}">{{ bond_doc.gemini_status }}</span>
                        {% else %}
                            <p class="text-muted">æœªå®Ÿè¡Œ</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6>Claude</h6>
                        {% if bond_doc.claude_processing_time %}
                            <h3 class="text-warning">{{ bond_doc.claude_processing_time|floatformat:2 }}ç§’</h3>
                            <span class="status-badge status-{{ bond_doc.claude_status }}">{{ bond_doc.claude_status }}</span>
                        {% else %}
                            <p class="text-muted">æœªå®Ÿè¡Œ</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¿ãƒ–ã§åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ãªçµæœè¡¨ç¤º -->
    <div class="mt-4">
        <h5>ğŸ“Š èªè­˜çµæœã®æ¯”è¼ƒ</h5>
        <ul class="nav nav-tabs" id="resultTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="ocr-tab" data-bs-toggle="tab" data-bs-target="#ocr" type="button" role="tab">
                    {% if bond_doc.file_type == 'pdf' %}ï¿½ pdfplumber{% else %}ï¿½ğŸ”¤ Tesseract OCR{% endif %}
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="ai-tab" data-bs-toggle="tab" data-bs-target="#ai" type="button" role="tab">
                    ğŸ¤– GPT-4o
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="gemini-tab" data-bs-toggle="tab" data-bs-target="#gemini" type="button" role="tab">
                    âœ¨ Gemini
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="claude-tab" data-bs-toggle="tab" data-bs-target="#claude" type="button" role="tab">
                    ğŸ§  Claude
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="comparison-tab" data-bs-toggle="tab" data-bs-target="#comparison" type="button" role="tab">
                    ğŸ“ˆ æ¯”è¼ƒåˆ†æ
                </button>
            </li>
        </ul>
        <div class="tab-content mt-3" id="resultTabsContent">
            <!-- OCRçµæœ -->
            <div class="tab-pane fade show active" id="ocr" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">{% if bond_doc.file_type == 'pdf' %}pdfplumber{% else %}Tesseract OCR{% endif %} æŠ½å‡ºçµæœ</h6>
                    </div>
                    <div class="card-body" style="background-color: #f8f9fa;">
                        {% if bond_doc.ocr_result %}
                            <div class="mb-2">
                                <strong>æ–‡å­—æ•°:</strong> {{ bond_doc.ocr_result|length }} æ–‡å­—
                            </div>
                            <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: monospace; max-height: 500px; overflow-y: auto;">{{ bond_doc.ocr_result }}</pre>
                        {% elif bond_doc.ocr_error %}
                            <div class="alert alert-danger">
                                ã‚¨ãƒ©ãƒ¼: {{ bond_doc.ocr_error }}
                            </div>
                        {% else %}
                            <p class="text-muted">çµæœãŒã‚ã‚Šã¾ã›ã‚“</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- GPT-4oçµæœ -->
            <div class="tab-pane fade" id="ai" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">GPT-4o è§£æçµæœ</h6>
                    </div>
                    <div class="card-body" style="background-color: #f8f9fa;">
                        {% if bond_doc.ai_result %}
                            <div class="mb-2">
                                <strong>æ–‡å­—æ•°:</strong> {{ bond_doc.ai_result|length }} æ–‡å­—
                            </div>
                            <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: monospace; max-height: 500px; overflow-y: auto;">{{ bond_doc.ai_result }}</pre>
                        {% elif bond_doc.ai_error %}
                            <div class="alert alert-danger">
                                ã‚¨ãƒ©ãƒ¼: {{ bond_doc.ai_error }}
                            </div>
                        {% else %}
                            <p class="text-muted">çµæœãŒã‚ã‚Šã¾ã›ã‚“</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Geminiçµæœ -->
            <div class="tab-pane fade" id="gemini" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">Gemini è§£æçµæœ</h6>
                    </div>
                    <div class="card-body" style="background-color: #f8f9fa;">
                        {% if bond_doc.gemini_result %}
                            <div class="mb-2">
                                <strong>æ–‡å­—æ•°:</strong> {{ bond_doc.gemini_result|length }} æ–‡å­—
                            </div>
                            <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: monospace; max-height: 500px; overflow-y: auto;">{{ bond_doc.gemini_result }}</pre>
                        {% elif bond_doc.gemini_status == 'failed' %}
                            <div class="alert alert-danger">
                                ã‚¨ãƒ©ãƒ¼: {{ bond_doc.gemini_result }}
                            </div>
                        {% else %}
                            <p class="text-muted">çµæœãŒã‚ã‚Šã¾ã›ã‚“</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Claudeçµæœ -->
            <div class="tab-pane fade" id="claude" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">Claude è§£æçµæœ</h6>
                    </div>
                    <div class="card-body" style="background-color: #f8f9fa;">
                        {% if bond_doc.claude_result %}
                            <div class="mb-2">
                                <strong>æ–‡å­—æ•°:</strong> {{ bond_doc.claude_result|length }} æ–‡å­—
                            </div>
                            <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: monospace; max-height: 500px; overflow-y: auto;">{{ bond_doc.claude_result }}</pre>
                        {% elif bond_doc.claude_status == 'failed' %}
                            <div class="alert alert-danger">
                                ã‚¨ãƒ©ãƒ¼: {{ bond_doc.claude_result }}
                            </div>
                        {% else %}
                            <p class="text-muted">çµæœãŒã‚ã‚Šã¾ã›ã‚“</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- æ¯”è¼ƒåˆ†æ -->
            <div class="tab-pane fade" id="comparison" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">ç²¾åº¦æ¯”è¼ƒåˆ†æ</h6>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>é …ç›®</th>
                                    <th>Tesseract OCR</th>
                                    <th>ç”ŸæˆAI</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</strong></td>
                                    <td><span class="status-badge status-{{ bond_doc.ocr_status }}">{{ bond_doc.ocr_status }}</span></td>
                                    <td><span class="status-badge status-{{ bond_doc.ai_status }}">{{ bond_doc.ai_status }}</span></td>
                                </tr>
                                <tr>
                                    <td><strong>å‡¦ç†æ™‚é–“</strong></td>
                                    <td>{{ bond_doc.ocr_processing_time|floatformat:2|default:"-" }} ç§’</td>
                                    <td>{{ bond_doc.ai_processing_time|floatformat:2|default:"-" }} ç§’</td>
                                </tr>
                                <tr>
                                    <td><strong>æŠ½å‡ºæ–‡å­—æ•°</strong></td>
                                    <td>{{ bond_doc.ocr_result|length|default:"0" }} æ–‡å­—</td>
                                    <td>{{ bond_doc.ai_result|length|default:"0" }} æ–‡å­—</td>
                                </tr>
                                {% if bond_doc.correct_text %}
                                <tr>
                                    <td><strong>é©åˆç‡</strong></td>
                                    <td>
                                        {% if bond_doc.ocr_accuracy %}
                                            <h5 class="mb-0 {% if bond_doc.ocr_accuracy >= 80 %}text-success{% elif bond_doc.ocr_accuracy >= 60 %}text-warning{% else %}text-danger{% endif %}">
                                                {{ bond_doc.ocr_accuracy }}%
                                            </h5>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if bond_doc.ai_accuracy %}
                                            <h5 class="mb-0 {% if bond_doc.ai_accuracy >= 80 %}text-success{% elif bond_doc.ai_accuracy >= 60 %}text-warning{% else %}text-danger{% endif %}">
                                                {{ bond_doc.ai_accuracy }}%
                                            </h5>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <td><strong>ç‰¹å¾´</strong></td>
                                    <td>
                                        <ul class="mb-0">
                                            <li>ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹</li>
                                            <li>é«˜é€Ÿå‡¦ç†</li>
                                            <li>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯èƒ½</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul class="mb-0">
                                            <li>é«˜ç²¾åº¦</li>
                                            <li>æ–‡è„ˆç†è§£</li>
                                            <li>æ§‹é€ åŒ–å‡ºåŠ›</li>
                                        </ul>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        {% if bond_doc.correct_text %}
                        <div class="alert alert-success mt-3">
                            <h6>âœ… æ­£è§£ãƒ†ã‚­ã‚¹ãƒˆã¨æ¯”è¼ƒã—ãŸé©åˆç‡</h6>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="text-center">
                                        <p class="mb-1"><strong>OCRé©åˆç‡</strong></p>
                                        {% if bond_doc.ocr_accuracy %}
                                            <h3 class="{% if bond_doc.ocr_accuracy >= 80 %}text-success{% elif bond_doc.ocr_accuracy >= 60 %}text-warning{% else %}text-danger{% endif %}">
                                                {{ bond_doc.ocr_accuracy }}%
                                            </h3>
                                        {% else %}
                                            <p class="text-muted">è¨ˆç®—ã§ãã¾ã›ã‚“ã§ã—ãŸ</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-center">
                                        <p class="mb-1"><strong>ç”ŸæˆAIé©åˆç‡</strong></p>
                                        {% if bond_doc.ai_accuracy %}
                                            <h3 class="{% if bond_doc.ai_accuracy >= 80 %}text-success{% elif bond_doc.ai_accuracy >= 60 %}text-warning{% else %}text-danger{% endif %}">
                                                {{ bond_doc.ai_accuracy }}%
                                            </h3>
                                        {% else %}
                                            <p class="text-muted">è¨ˆç®—ã§ãã¾ã›ã‚“ã§ã—ãŸ</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <p class="mb-0"><strong>æ­£è§£ãƒ†ã‚­ã‚¹ãƒˆ:</strong></p>
                            <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: monospace; max-height: 150px; overflow-y: auto; background-color: white; padding: 10px; border-radius: 5px;">{{ bond_doc.correct_text }}</pre>
                        </div>
                        {% endif %}
                        
                        <div class="alert alert-info mt-3">
                            <h6>ğŸ’¡ ç²¾åº¦è©•ä¾¡ã®ãƒã‚¤ãƒ³ãƒˆ</h6>
                            <ul class="mb-0">
                                <li><strong>å‡¦ç†æ™‚é–“:</strong> ã‚ˆã‚ŠçŸ­ã„æ–¹ãŒåŠ¹ç‡çš„</li>
                                <li><strong>é©åˆç‡:</strong> 80%ä»¥ä¸Šã§è‰¯å¥½ã€60%ä»¥ä¸Šã§æ™®é€šã€60%æœªæº€ã§è¦æ”¹å–„</li>
                                <li><strong>æ§‹é€ åŒ–:</strong> ç”ŸæˆAIã¯æƒ…å ±ã‚’æ•´ç†ã—ã¦å‡ºåŠ›</li>
                                <li><strong>ã‚³ã‚¹ãƒˆ:</strong> OCRã¯ç„¡æ–™ã€ç”ŸæˆAIã¯APIã‚³ã‚¹ãƒˆãŒç™ºç”Ÿ</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% elif bond_doc.analysis_status == 'failed' %}
    <div class="alert alert-danger mt-4">
        <h5>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h5>
        <p class="mb-0">{{ bond_doc.error_message }}</p>
    </div>
    {% elif bond_doc.analysis_status == 'processing' %}
    <div class="alert alert-info mt-4">
        <h5>â³ å‡¦ç†ä¸­</h5>
        <p class="mb-0">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã¦ã„ã¾ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„...</p>
    </div>
    {% endif %}
</div>
{% endblock %}
