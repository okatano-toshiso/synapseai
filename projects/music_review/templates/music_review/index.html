{% extends "custom.html" %}
{% block title %}Home Page{% endblock %}
{% block content %}
{% load static %}

<section class="contents">
    <h2 class="title">Music Review Generator</h2>
    <p class="description">
        Generate insightful music reviews effortlessly with our AI-powered tool. Perfect for critics, content creators, and music enthusiasts looking for quick, quality analysis.
    </p>
    <form method="POST">
        {% csrf_token %}
        <article class="model-selector">
            <h3 class="label">MODEL SELECTION</h3>
            <div class="model-select-wrapper">
                <label for="{{ form.model.id_for_label }}">{{ form.model.label }}</label>
                {{ form.model }}
            </div>
        </article>
        <article class="review-editor">
            <h3 class="label">EDITER AREA</h3>
            <ul class="lists">
                <li>{{ form.title.label_tag }} {{ form.title }}</li>
                <li>{{ form.artist.label_tag }} {{ form.artist }}</li>
                <li>{{ form.comment.label_tag }} {{ form.comment }}</li>
                <li>{{ form.recommend.label_tag }} {{ form.recommend }}</li>
                <li>{{ form.wiki_discography.label_tag }} {{ form.wiki_discography }}</li>
                <li>{{ form.no_data.label_tag }} {{ form.no_data }}</li>
                <li id="release-field" style="display: none;">{{ form.release_date.label_tag }} {{ form.release_date }}</li>
                <li id="label-field" style="display: none;">{{ form.label.label_tag }} {{ form.label }}</li>
                <li id="producer-field" style="display: none;">{{ form.producer_name.label_tag }} {{ form.producer_name }}</li>
                <li>{{ form.wiki_biography.label_tag }} {{ form.wiki_biography }}</li>
                <li>{{ form.source1.label_tag }} {{ form.source1 }}</li>
                <li>{{ form.source2.label_tag }} {{ form.source2 }}</li>
                <li>{{ form.spotyfi.label_tag }} {{ form.spotyfi }}</li>
                <li>{{ form.youtube.label_tag }} {{ form.youtube }}</li>
            </ul>
            <div class="submit_area">
                <button type="submit" class="output">OUTPUT</button>
                <button type="reset" class="reset">RESET</button>
                <button type="button" class="title-reset">TITLE_REST</button>
            </div>
        </form>
    </article>
    <article class="result">
        <h3 class="label">RESPONSE</h3>
        <div class="result_area copy-target">
            {{ chat_results|safe }}
        </div>
        <div class="copy_area">
            <button id="copyButton" class="copy">COPY</button>
        </div>
    </article>
</section>
<script type="text/javascript" src="{% static 'js/click_copy.js' %}" rel="stylesheet"></script>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    const resetButton = document.querySelector('.reset');
    const titleResetButton = document.querySelector('.title-reset');
    const noDataCheckbox = document.querySelector('[name="no_data"]');
    const releaseField = document.getElementById('release-field');
    const labelField = document.getElementById('label-field');
    const producerField = document.getElementById('producer-field');
    
    // NO DATAチェックボックスの表示/非表示制御
    if (noDataCheckbox) {
        noDataCheckbox.addEventListener('change', function() {
            if (this.checked) {
                releaseField.style.display = '';
                labelField.style.display = '';
                producerField.style.display = '';
            } else {
                releaseField.style.display = 'none';
                labelField.style.display = 'none';
                producerField.style.display = 'none';
            }
        });
    }
    
    // 全リセット機能
    resetButton.addEventListener('click', function(e) {
        e.preventDefault();
        
        const form = document.querySelector('form');
        const inputs = form.querySelectorAll('input, textarea, select');
        
        inputs.forEach(function(input) {
            if (input.type === 'text' || input.type === 'email' || input.type === 'password' || input.tagName === 'TEXTAREA') {
                input.value = '';
            } else if (input.type === 'checkbox' || input.type === 'radio') {
                input.checked = false;
            } else if (input.tagName === 'SELECT') {
                input.selectedIndex = 0;
            }
        });
        
        // RELEASE、LABEL、PRODUCERフィールドを非表示にする
        releaseField.style.display = 'none';
        labelField.style.display = 'none';
        producerField.style.display = 'none';
        
        const resultArea = document.querySelector('.result_area');
        if (resultArea) {
            resultArea.innerHTML = '';
        }
    });
    
    // TITLE、COMMENT、RECOMMEND、WIKI_DISCのみクリア
    titleResetButton.addEventListener('click', function(e) {
        e.preventDefault();
        
        // 対象フィールドの名前リスト
        const targetFields = ['title', 'comment', 'recommend', 'wiki_discography', 'spotyfi', 'youtube'];
        
        targetFields.forEach(function(fieldName) {
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field) {
                field.value = '';
            }
        });
    });
});
</script>
{% endblock %}
